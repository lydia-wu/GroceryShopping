<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
    <meta name="description" content="The Best Household Meal Plan - Track your 6-meal rotation with ease">
    <meta name="theme-color" content="#5D4037">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="brown-translucent">
    <title>Meal Planner Dashboard</title>
    <link rel="stylesheet" href="css/styles.css">
</head>
<body>
    <div class="dashboard">
        <!-- Header -->
        <header class="header">
            <div class="container header-content">
                <div>
                    <h1 class="header-title">The Best Household Meal Plan</h1>
                    <p class="header-subtitle">6-Meal Rotation Tracker</p>
                </div>
                <div class="header-actions">
                    <nav class="nav">
                        <button class="nav-btn active" data-view="dashboard">Dashboard</button>
                        <button class="nav-btn" data-view="meals">Meals</button>
                        <button class="nav-btn" data-view="shopping">Shopping</button>
                        <button class="nav-btn" data-view="analytics">Analytics</button>
                    </nav>
                    <span class="header-version" id="version-display">v1.0.0</span>
                </div>
            </div>
        </header>

        <!-- Main Content -->
        <main class="main-content">
            <div class="container">
                <!-- Hero Section - Next Meal -->
                <section class="hero" id="hero-section">
                    <p class="hero-date" id="today-date">Loading...</p>
                    <h2 class="hero-title">NEXT UP: <span id="next-meal-name">Loading...</span></h2>
                    <p class="hero-subtitle" id="next-meal-details">Loading meal details...</p>
                    <div class="hero-meta">
                        <div class="hero-meta-item">
                            <span>Scheduled:</span>
                            <strong id="next-meal-date">--</strong>
                        </div>
                        <div class="hero-meta-item">
                            <span>Servings:</span>
                            <strong id="next-meal-servings">--</strong>
                        </div>
                        <div class="hero-meta-item">
                            <span>Est. Cost:</span>
                            <strong id="next-meal-cost">--</strong>
                        </div>
                        <div class="hero-meta-item">
                            <span>Prep + Cook:</span>
                            <strong id="next-meal-time">--</strong>
                        </div>
                    </div>
                </section>

                <!-- Rotation Timeline -->
                <section class="section">
                    <h3 class="section-title">Meal Rotation</h3>
                    <div class="rotation-timeline" id="rotation-timeline">
                        <!-- Populated by JS -->
                        <div class="rotation-item loading-skeleton skeleton-card"></div>
                        <div class="rotation-item loading-skeleton skeleton-card"></div>
                        <div class="rotation-item loading-skeleton skeleton-card"></div>
                        <div class="rotation-item loading-skeleton skeleton-card"></div>
                        <div class="rotation-item loading-skeleton skeleton-card"></div>
                        <div class="rotation-item loading-skeleton skeleton-card"></div>
                    </div>
                </section>

                <!-- Meal Cards Grid -->
                <section class="section" id="meals-section">
                    <div class="flex justify-between items-center mb-4">
                        <h3 class="section-title" style="margin-bottom:0;">All Meals</h3>
                        <div class="flex gap-2">
                            <button class="btn btn-outline btn-sm" id="manage-rotation-btn">Manage Rotation</button>
                            <button class="btn btn-primary btn-sm" id="log-cooking-btn">Log Cooking</button>
                        </div>
                    </div>
                    <div class="meals-grid" id="meals-grid">
                        <!-- Populated by JS -->
                        <div class="meal-card loading-skeleton skeleton-card"></div>
                        <div class="meal-card loading-skeleton skeleton-card"></div>
                        <div class="meal-card loading-skeleton skeleton-card"></div>
                    </div>
                </section>

                <!-- Charts Section -->
                <section class="section" id="charts-section">
                    <h3 class="section-title">Analytics</h3>
                    <div class="charts-grid">
                        <div class="chart-card">
                            <h4 class="chart-title">Cost per Meal</h4>
                            <div class="chart-container">
                                <canvas id="cost-per-meal-chart"></canvas>
                            </div>
                        </div>
                        <div class="chart-card">
                            <h4 class="chart-title">Spending by Trip</h4>
                            <div class="chart-container">
                                <canvas id="spending-by-trip-chart"></canvas>
                            </div>
                        </div>
                        <div class="chart-card">
                            <h4 class="chart-title">Macros per Meal</h4>
                            <div class="chart-container">
                                <canvas id="macros-chart"></canvas>
                            </div>
                        </div>
                        <div class="chart-card">
                            <h4 class="chart-title">Store Breakdown</h4>
                            <div class="chart-container">
                                <canvas id="store-breakdown-chart"></canvas>
                            </div>
                        </div>
                        <div class="chart-card">
                            <h4 class="chart-title">Micronutrients</h4>
                            <div class="chart-container">
                                <canvas id="micronutrients-chart"></canvas>
                            </div>
                        </div>
                        <div class="chart-card">
                            <h4 class="chart-title">Nutritional Completeness</h4>
                            <div class="chart-container">
                                <canvas id="nutrition-radar-chart"></canvas>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- Staples Tracker Section -->
                <section class="section" id="staples-section">
                    <div class="flex justify-between items-center mb-4">
                        <h3 class="section-title" style="margin-bottom:0;">Homemade Staples</h3>
                        <button class="btn btn-outline btn-sm" id="log-staple-btn">Log Production</button>
                    </div>
                    <div class="staples-grid" id="staples-grid">
                        <!-- Populated by JS -->
                    </div>
                </section>

                <!-- What's Fresh Now Section -->
                <section class="fresh-section" id="fresh-section">
                    <h3 class="fresh-title">
                        <span>What's Fresh Now</span>
                        <span id="fresh-month">- January</span>
                    </h3>
                    <div class="fresh-grid">
                        <div class="fresh-column">
                            <h4>Fruits</h4>
                            <ul class="fresh-list" id="fresh-fruits">
                                <!-- Populated by JS -->
                            </ul>
                        </div>
                        <div class="fresh-column">
                            <h4>Vegetables</h4>
                            <ul class="fresh-list" id="fresh-vegetables">
                                <!-- Populated by JS -->
                            </ul>
                        </div>
                    </div>
                </section>
            </div>
        </main>

        <!-- Footer -->
        <footer style="text-align: center; padding: 2rem; color: var(--color-gray-500); font-size: var(--font-size-sm);">
            <p>The Best Household Meal Plan &bull; <span id="footer-version">v1.0.0</span></p>
            <p>Data from: MealCostCalculator.xlsx &bull; Google Sheets &bull; USDA FoodData Central</p>
        </footer>
    </div>

    <!-- Log Cooking Modal -->
    <div class="modal-backdrop" id="log-cooking-modal-backdrop">
        <div class="modal" id="log-cooking-modal">
            <div class="modal-header">
                <h3 class="modal-title">Log Cooking Session</h3>
                <button class="modal-close" id="close-log-cooking">&times;</button>
            </div>
            <div class="modal-body">
                <form id="log-cooking-form">
                    <div class="form-group">
                        <label class="form-label" for="log-meal-select">Meal</label>
                        <select class="form-select" id="log-meal-select" required>
                            <option value="">Select a meal...</option>
                            <!-- Populated by JS -->
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="form-label" for="log-date">Date Cooked</label>
                        <input type="date" class="form-input" id="log-date" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label" for="log-servings">Servings Made</label>
                        <input type="number" class="form-input" id="log-servings" min="1" max="20">
                    </div>
                    <div class="form-group">
                        <label class="form-label" for="log-notes">Notes (optional)</label>
                        <textarea class="form-textarea" id="log-notes" placeholder="Any notes about this cooking session..."></textarea>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" id="cancel-log-cooking">Cancel</button>
                <button class="btn btn-primary" id="save-log-cooking">Save</button>
            </div>
        </div>
    </div>

    <!-- Nutrition Detail Modal -->
    <div class="modal-backdrop" id="nutrition-modal-backdrop">
        <div class="modal" id="nutrition-modal" style="max-width: 700px;">
            <div class="modal-header">
                <h3 class="modal-title">Nutrition: <span id="nutrition-meal-name">--</span></h3>
                <button class="modal-close" id="close-nutrition">&times;</button>
            </div>
            <div class="modal-body">
                <p class="text-muted text-small mb-4">Per Serving (<span id="nutrition-serving-info">1 of 6</span>)</p>

                <!-- Macros Grid -->
                <div class="nutrition-section">
                    <h4 class="nutrition-section-title">Macros</h4>
                    <div class="nutrition-grid" id="nutrition-macros">
                        <!-- Populated by JS -->
                    </div>
                </div>

                <!-- Vitamins -->
                <div class="nutrition-section">
                    <h4 class="nutrition-section-title">Vitamins</h4>
                    <div id="nutrition-vitamins">
                        <!-- Populated by JS -->
                    </div>
                </div>

                <!-- Minerals -->
                <div class="nutrition-section">
                    <h4 class="nutrition-section-title">Minerals</h4>
                    <div id="nutrition-minerals">
                        <!-- Populated by JS -->
                    </div>
                </div>

                <!-- Fun Facts -->
                <div class="nutrition-section">
                    <h4 class="nutrition-section-title">Fun Facts</h4>
                    <div id="nutrition-facts">
                        <!-- Populated by JS -->
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" id="close-nutrition-btn">Close</button>
            </div>
        </div>
    </div>

    <!-- Manage Rotation Modal -->
    <div class="modal-backdrop" id="rotation-modal-backdrop">
        <div class="modal" id="rotation-modal">
            <div class="modal-header">
                <h3 class="modal-title">Manage Rotation (<span id="rotation-count">6</span> of 10 max)</h3>
                <button class="modal-close" id="close-rotation">&times;</button>
            </div>
            <div class="modal-body">
                <div id="rotation-list">
                    <!-- Populated by JS -->
                </div>
                <div class="mt-4 flex gap-2">
                    <button class="btn btn-primary" id="add-meal-btn">+ Add New Meal</button>
                    <button class="btn btn-outline" id="view-library-btn">View Library</button>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" id="close-rotation-btn">Close</button>
            </div>
        </div>
    </div>

    <!-- Shopping List Modal -->
    <div class="modal-backdrop" id="shopping-modal-backdrop">
        <div class="modal" id="shopping-modal" style="max-width: 800px;">
            <div class="modal-header">
                <h3 class="modal-title">Shopping List Generator</h3>
                <button class="modal-close" id="close-shopping">&times;</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label class="form-label">Select meals to shop for:</label>
                    <div id="shopping-meal-checkboxes" class="flex flex-wrap gap-2">
                        <!-- Populated by JS -->
                    </div>
                </div>
                <div id="shopping-list-output" class="shopping-list hidden">
                    <!-- Populated by JS -->
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-outline" id="copy-shopping-list">Copy to Clipboard</button>
                <button class="btn btn-primary" id="generate-shopping-list">Generate List</button>
            </div>
        </div>
    </div>

    <!-- Add/Edit Meal Modal -->
    <div class="modal-backdrop" id="meal-edit-modal-backdrop">
        <div class="modal" id="meal-edit-modal" style="max-width: 700px;">
            <div class="modal-header">
                <h3 class="modal-title" id="meal-edit-title">Add New Meal</h3>
                <button class="modal-close" id="close-meal-edit">&times;</button>
            </div>
            <div class="modal-body">
                <form id="meal-edit-form">
                    <div class="form-group">
                        <label class="form-label" for="meal-name-input">Meal Name *</label>
                        <input type="text" class="form-input" id="meal-name-input" required placeholder="e.g., Kale & Chicken Pasta">
                    </div>
                    <div class="flex gap-4">
                        <div class="form-group" style="flex:1;">
                            <label class="form-label" for="meal-servings-input">Servings *</label>
                            <input type="number" class="form-input" id="meal-servings-input" required min="1" max="20" placeholder="6">
                        </div>
                        <div class="form-group" style="flex:1;">
                            <label class="form-label" for="meal-prep-time">Prep Time (min) *</label>
                            <input type="number" class="form-input" id="meal-prep-time" required min="0" placeholder="20">
                        </div>
                        <div class="form-group" style="flex:1;">
                            <label class="form-label" for="meal-cook-time">Cook Time (min) *</label>
                            <input type="number" class="form-input" id="meal-cook-time" required min="0" placeholder="30">
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="form-label" for="meal-ingredients-input">Ingredients * (one per line, with quantities)</label>
                        <textarea class="form-textarea" id="meal-ingredients-input" required placeholder="1 lb chicken breast&#10;2 bunches kale&#10;8 oz pasta..." style="min-height: 150px;"></textarea>
                    </div>
                    <div class="form-group">
                        <label class="form-label" for="meal-instructions-input">Instructions *</label>
                        <textarea class="form-textarea" id="meal-instructions-input" required placeholder="Step-by-step cooking instructions..." style="min-height: 150px;"></textarea>
                    </div>
                    <div class="form-group">
                        <label class="form-label" for="meal-sides-input">Serve With (optional, comma-separated)</label>
                        <input type="text" class="form-input" id="meal-sides-input" placeholder="e.g., Sourdough bread, Grapefruit">
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" id="cancel-meal-edit">Cancel</button>
                <button class="btn btn-primary" id="save-meal-edit">Save Meal</button>
            </div>
        </div>
    </div>

    <!-- Log Staple Modal -->
    <div class="modal-backdrop" id="staple-modal-backdrop">
        <div class="modal" id="staple-modal">
            <div class="modal-header">
                <h3 class="modal-title">Log Staple Production</h3>
                <button class="modal-close" id="close-staple">&times;</button>
            </div>
            <div class="modal-body">
                <form id="staple-form">
                    <div class="form-group">
                        <label class="form-label" for="staple-select">Item</label>
                        <select class="form-select" id="staple-select" required>
                            <option value="">Select item...</option>
                            <option value="sourdough">Sourdough Bread</option>
                            <option value="yogurt">Yogurt</option>
                            <option value="breadcrumbs">Breadcrumbs</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="form-label" for="staple-date">Production Date</label>
                        <input type="date" class="form-input" id="staple-date" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label" for="staple-quantity">Quantity</label>
                        <input type="text" class="form-input" id="staple-quantity" required placeholder="e.g., 3 loaves, 6.5 pints">
                    </div>
                    <div class="form-group">
                        <label class="form-label" for="staple-notes">Notes (optional)</label>
                        <textarea class="form-textarea" id="staple-notes" placeholder="Any notes about this batch..."></textarea>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" id="cancel-staple">Cancel</button>
                <button class="btn btn-primary" id="save-staple">Save</button>
            </div>
        </div>
    </div>

    <!-- Meal Library Modal -->
    <div class="modal-backdrop" id="library-modal-backdrop">
        <div class="modal" id="library-modal">
            <div class="modal-header">
                <h3 class="modal-title">Meal Library</h3>
                <button class="modal-close" id="close-library">&times;</button>
            </div>
            <div class="modal-body">
                <div id="library-list">
                    <!-- Populated by JS -->
                    <div class="empty-state">
                        <div class="empty-state-icon">&#128218;</div>
                        <h4 class="empty-state-title">No Archived Meals</h4>
                        <p class="empty-state-text">Archived meals will appear here. You can restore them to your rotation at any time.</p>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" id="close-library-btn">Close</button>
            </div>
        </div>
    </div>

    <!-- Toast Container -->
    <div class="toast-container" id="toast-container"></div>

    <!-- External Libraries (loaded from CDN) -->
    <script src="https://cdn.sheetjs.com/xlsx-0.20.1/package/dist/xlsx.full.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>

    <!-- App Scripts -->
    <script type="module" src="js/app.js"></script>
</body>
</html>
